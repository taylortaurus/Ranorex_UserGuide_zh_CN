# [译] 图像自动化进阶

*原文地址 👉 [Advanced image-based automation][0]*

*@ translator : [TaylorTaurus](https://github.com/taylortaurus)*    
*♋ translate time : 2018-9-12*  

---

在某些情况下，基于图像的自动化基本上是当前测试挑战的解决方案，但实际上，如果未能更详细地设定或是配置，测试则会失败。

如果，在任何情况下 - 要识别的图像，以图形（光学）方式修改，则使用默认设置和配置的基于图像的自动化将失败。修改可以通过屏幕激活（=突出显示）或任何其他形式的图形更改。其他挑战可能是参考图像不是唯一的，并且识别替代（即错误）图像而不是参考图像。

在任何情况下，如果要识别的图像已通过图形(光学)方式修改了基于图像的自动化，那么默认的设置和配置将会失败。修改可以通过屏幕激活(高亮显示)，或任何其他形式的图形改变。其他的挑战可能是参考图像不是唯一的，替代的(即错误的)图像被识别而不是参考图像。

本节将会介绍如何配置和设定基于图像的自动化，以便它仍然可以工作。基于文本的自动化在其应用中是清晰和简单的，而基于图像的自动化有时需要创造力和如何解决出现的问题的知识。

本章导视，章节内段落跳转推荐使用右上角的锚点！

- [图像未识别成功的改进](##图像未识别成功的改进)
- [图像识别错误的改进](##图像识别错误的改进)
- [建议](##建议)

## 图像未识别成功的改进

有时候，UI元素的微小变化，如不同颜色的背景或字体颜色，可能导致测试运行失败。面临的挑战是，需要正确地识别UI元素，而不需要在图形表示中进行微小的更改。本章概述并解释了如何做到这一点。

### 测试示例录制

按照以下说明录制一个“内置”运行失败的测试。

![B7030-0000010](https://gitee.com/taylortaurus/RX_UserGuide_GitBook_Picbed/raw/master/Image-basedAutomation/B7030-0000010.png)  
*图像未找到-测试示例准备*  

1. 打开基于图像的自动化模式进行录制
2. 在日历视图中跟踪并标识一个示例日期
3. 在动作结果表中查看录制的动作项

### 运行测试和测试结果

现在，让我们看看带有“正常”测试运行的结果，以及相应的UI元素在图形化上略有变化时的结果。

![B7030-0000020](https://gitee.com/taylortaurus/RX_UserGuide_GitBook_Picbed/raw/master/Image-basedAutomation/B7030-0000020.png)  
*图像未识别-测试运行*  

1. 成功的测试运行
   
    1. 使用没有修改日历视图的运行测试，测试成功运行
    2. 看到运行成功的测试报告中准确标识到UI元素
   
2. 失败的测试运行
    
    1. UI元素在图形上略有变化——单击它会有一个灰色背景
    2. UI元素并不是最初抓取和识别的对象，因此测试运行失败
    3. 使用默认的基于图像的设置，Ranorex无法识别更改后的UI元素


![B7030-0000030](https://gitee.com/taylortaurus/RX_UserGuide_GitBook_Picbed/raw/master/Image-basedAutomation/B7030-0000030.png)  
*最初跟踪和识别ui元素以及更改后UI元素*  

3. 测试报告中的失败信息
    
    1. 更改灰色背景后的图像不能被识别到
    2. 测试运行终止


### 解决方案

需要修改基于图像的设置来解决这个问题。因此，打开动作属性并遵循下面的说明。

![B7030-0000040](https://gitee.com/taylortaurus/RX_UserGuide_GitBook_Picbed/raw/master/Image-basedAutomation/B7030-0000040.png)  
*打开和修改基于图像的属性设置*  

1. 选择动作项并按F4打开动作属性
2. 打开基于图像属性的下拉列表

![B7030-0000050](https://gitee.com/taylortaurus/RX_UserGuide_GitBook_Picbed/raw/master/Image-basedAutomation/B7030-0000050.png)  
*设置基于图像的属性*  

1. 预处理选项
    
    1. 预处理选项实现了几个图形过滤器 
    2. 这些过滤器使UI检测对颜色(变化)、锐度和图形外观的其他变化免疫
    3. 选择如图所示的过滤器

2. 相似性系数

    1. 预处理步骤去除一些图像差异，但不是全部
    2. 因此，需要删除默认的100%相似匹配
    3. 设置相似系数，如图所示

**章节预读**
> 在[基于图像的属性][1]一文中，详细介绍了基于图像的各种属性，如相似系数和图形过滤器


### 改进的测试运行

现在重新运行测试，可以看到测试成功的报告显示的改进结果。

![B7030-0000060](https://gitee.com/taylortaurus/RX_UserGuide_GitBook_Picbed/raw/master/Image-basedAutomation/B7030-0000060.png)  
*改进后运行成功的测试报告*  

1. 修改的日历视图中日期的灰色背景
2. 成功识别的UI元素的测试报告

## 图像识别错误的改进  

在某些情况下，基于图像的自动化会导致奇怪的效果。在此引入和讨论了其中一种情况及其解决方案。

### 测试示例准备和记录

假设在演示应用程序的日历视图中跟踪和标识日历日期。并且进一步假设最初跟踪和记录的UI元素已经找不到，但是找到了一个替代的错误的UI元素。

![B7030-0000070](https://gitee.com/taylortaurus/RX_UserGuide_GitBook_Picbed/raw/master/Image-basedAutomation/B7030-0000070.png)  
*错误的图像识别-测试示例准备*  

1. 在演示应用程序的当前日历视图中跟踪并记录日历日期
2. 请参阅基于图像章节中日期的选择与周围的粉红色框架
3. 结果是动作表中的一个动作项


### 测试运行结果

让我们假设最初记录的UI元素与测试运行期间要标识的UI元素在图形上不同。

![B7030-0000080](https://gitee.com/taylortaurus/RX_UserGuide_GitBook_Picbed/raw/master/Image-basedAutomation/B7030-0000080.png)  
*发现错误的图像-测试运行*  

1. `5月7日`是日历视图的最初跟踪和识别的ui元素。与先前录制相比，它现在有一个灰色的背景，因此不能被Ranorex识别

2. 相反，Ranorex搜索类似的UI元素，并在日历视图的底部找到一个今天日期中定义的:5/7/2018


### 解决方案

解决方案是细化基于图像的对象选择，这是通过内置的图像编辑器实现的。

![B7030-0000090](https://gitee.com/taylortaurus/RX_UserGuide_GitBook_Picbed/raw/master/Image-basedAutomation/B7030-0000090.png)  
*基于图像的对象选择细化*  

1. 默认的基于图像的通常选择非常相似对象。因此，多个对象可以匹配
2. 手动细化基于图像的选择，识别所需的对象，并消除对其他类似UI元素的影响

### 图像编辑器

基于图像的选择可以通过内置编辑器进行细化和手动设置。

![B7030-0000100](https://gitee.com/taylortaurus/RX_UserGuide_GitBook_Picbed/raw/master/Image-basedAutomation/B7030-0000100.png)  
*使用图像编辑器细化基于图像的选择*

1. 选择动作项并单击按钮以打开图像编辑器
2. 手工细化和修改基于图像的选择
3. 单击OK以确认选择

## 建议

基于通过文本或其他可验证属性检测UI元素的自动化测试是非常简单的。另一方面，基于图像的自动化有时是实验性的，在解决问题和面对挑战时需要大量的经验、知识和创造力。
如果你遵循一些有用的建议，基于图像的自动化效果是很好的。

**独特性**

尝试确定一个尽可能独特的图像，或子图像，没有或很少可能有其他匹配，或类似的子图像。

**大小**

使你的参考图像尽可能小，尽可能大。这可能需要一些测试和实验。

**相似**

除非你真的想测试一个精确的匹配，否则千万不要使用1.0的相似系数!将因子设置为尽可能接近0.95，但尽可能接近0.99。事实上，相似度系数为0.98或0.99应该可以在大多数测试有效。

**预处理的属性**

使用预处理属性改进基于图像的选择机制。

**章节预读**  
> 在[基于图像的属性][1]一文，中详细介绍和解释了预处理特性。

****

[0]: https://www.ranorex.com/help/latest/ranorex-studio-advanced/image-based-automation/advanced-image-based-automation/
[1]: https://www.ranorex.com/help/latest/ranorex-studio-advanced/image-based-automation/image-based-properties/
